<!DOCTYPE html>
<html lang="en">
<head>
    
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>	
	<title>Cloudify - GigaSpaces And Storm Part 1 - Storm Clouds</title>
	<script src="//cdn.optimizely.com/js/59503762.js"></script>
	
	<link rel="canonical" href="http://www.cloudifysource.org/2013/03/07/gigaspaces_and_storm_part_1_storm_clouds.html"/>	
	<!-- custom -->
	<!--<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/atom.xml" />-->
	<link rel="canonical" href="http://www.cloudifysource.org/index.html"/>	
	<link rel="shortcut icon" href="/ico/favicon.png" type="image/x-icon" />
	<!-- css -->
	<link href="/css/bootstrap.css" rel="stylesheet" />
	<link href="/css/bootstrap-responsive.css" rel="stylesheet" />
	<link href="/css/fancybox/jquery.fancybox.css" rel="stylesheet">
	<link href="/css/jcarousel.css" rel="stylesheet" />
	<link href="/css/flexslider.css" rel="stylesheet" />
	<link href="/css/cslider.css" rel="stylesheet" />
	<link href="/css/style.css" rel="stylesheet" />
	<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	<!-- Theme skin -->
	<link id="t-colors" href="/skins/blue.css" rel="stylesheet" />
	<!-- boxed bg -->
	<link id="bodybg" href="/bodybg/bg1.css" rel="stylesheet" type="text/css" />
	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
		  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	<!-- Fav and touch icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png" />
	<link rel="shortcut icon" href="/ico/favicon.png" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
	<script src="/js/jquery.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
</head>

<body>
<div class="WrapperBg">    
    <div class="Wrapper">
        <!-- toggle top area -->
	<div class="hidden-top">
		<div class="hidden-top-inner container">
			<div class="row">
				<div class="span12">
					<ul>
						<li><strong><i class="icon-briefcase"></i>Go Pro! Find out about</strong><a class="black" href="goPro.html"> Enterprise Cloudify</a></li>
						</ul>
					</div>
			</div>
		</div>
	</div>
	
	<!-- end toggle top area -->
	<!-- start header -->
	<header class=" grayGrediant ">
	<div class="container ">
	
		<!-- hidden top area toggle link -->
		<div id="header-hidden-link">
			<a href="#" class="toggle-link" title="Go Pro with Enterprise Cloudify" data-target=".hidden-top">
			<i class="fa fa-plus"></i></a>
			<a class="toggle-link dwnBtn" href="/downloads/previous_ga_versions.html" data-toggle="tooltip" data-placement="bottom" title="Get the GA Release"><i class="fa-cloud-download"></i></a>
			<a class="toggle-link dwnBtn" href="/downloads/get_cloudify.html" data-toggle="tooltip" data-placement="bottom" title="Get the Latest Milestone Build">
				<i class="fa-download"></i></a>
			<div class="widget cdsearch">
			<form id="searchForm" class="form-search" action="#" method="get">
				<input placeholder="Search..." type="text" class="input-medium search-query ">
				<button id="goBtn" type="submit" class=" btn goBtn"><i class="iconsearch"></i></button>
			</form>
		</div>	
		</div>
		<!-- end toggle link -->
		
			
				
			
				
		
		
			
				<div class="logo navbar-toggle">
					<a href="index.html"><img src="/img/logo.png" alt="" class="logo" /></a>
				</div>
			
			  <nav class="navbar navbar-default" role="navigation">
                  <!-- Brand and toggle get grouped for better mobile display -->
                  <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                      <span class="sr-only">Toggle navigation</span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                    </button>
                    
                    
                  </div>		
					<!--<<div class="cdnavbar navbar  navbar-default" role="navigation">
							
								<div class="navigation navigation-bottom">
								nav>-->
									<!-- <ul class="nav topnav bold">-->
                    <div class="cdnavbar collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                    <ul class="nav navbar-nav">
                                        <li class="cloudifyLogo"><a href="index.html"><img src="/img/logoSmall.png" alt=""  /></a></li>
										<li class="dropdown active">
										<a href="https://cloudifysource.zendesk.com/forums" target="_blank">Support Forums</a>
										</li>
										<li class="dropdown">
										<a href="doc.html">Docs<i class="icon-angle-down"></i></a>
										<ul class="dropdown-menu bold" style="display: none;">
											<li><a href="#">2.3</a></li>
											<li><a href="#">2.5</a></li>
											<li><a href="/guide/2.6/qsg/qsg.html">2.6</a></li>
											<li><a href="#">2.7</a></li>
										</ul>
										</li>
										<li>
											<a href="/how/index.html">How it Works</a>
										</li>
										<li class="dropdown">
										<a href="#">Blog + Other Stuff <i class="icon-angle-down"></i></a>
										<ul class="dropdown-menu bold">
										<li><a href="blog-right-sidebar.html">Blog</a></li>
										<li><a href="#">The Cloudify Player</a></li>
										<li><a href="video.htm">Videos & Tutorials</a></li>
										<li><a href="participate.htm">Events</a></li>
										</ul>
										</li>
										
										<li>
											<a href="http://www.gigaspaces.com/cloudify" target="_blank"><strong>.Com</strong></a>
										</li>
										
									</ul>
				</div> 
        <!-- /.navbar-collapse -->
</nav>
</div>
		
</header>	
<!-- end header -->	
		
			<section id="inner-headline">
	<div class="container">
		<div class="row">
			<div class="span4">
				<div class="inner-heading">
					<h2><i class="icon-edit"></i>Cloudifysource<strong> Blogs</strong></h2>
				</div>
			</div>
			<div class="span8">
				<ul class="breadcrumb">
					<li><a href="#"><i class="icon-home"></i></a><i class="icon-angle-right"></i></li>
					<li><a href="#">Blog</a><i class="icon-angle-right"></i></li>
					<li class="active">GigaSpaces And Storm Part 1 - Storm Clouds</li>
				</ul>
			</div>
		</div>
	</div>
	</section>
	
	<section id="content">
	<div class="container">
			<div class="row">
				<!-- Blog Right side posts -->
				<div class="span9">
					<div id="resultsDiv" class="DocumentsWrap"></div>
					<div id="pageContent" class="DocumentsWrapRight">
					
					<h1 class="pageTitle">GigaSpaces And Storm Part 1 - Storm Clouds</h1>
					 
					  <span class="blogPostInfo">Posted By: <a href="#">DeWayne Filppi</a>  on March  7, 2013  
					  </span>
					  <br/><br/><br/>
					 
                    <div class="entry"><h3 style="color:blue"><strong>Introduction</strong></h3>
<p>Real-time processing is becoming very popular, and Storm is a popular open source framework and runtime used by Twitter for processing real-time data streams. &nbsp;Storm addresses the complexity of running real time streams through a compute cluster by providing an elegant set of abstractions that make it easier to reason about your problem domain by letting you focus on data flows rather than on implementation details. &nbsp;The framework takes your abstract flow definition and optimizes the deployment characteristics in the cluster to optimize throughput.</p>
<p>This post is part of a series about GigaSpaces and Storm. &nbsp;This series will span both GigaSpaces products, <span class="caps">XAP</span> and Cloudify. &nbsp;In this post I outline Storm itself for those that may be unfamiliar with it, and then the related Cloudify recipes I&#8217;ve created thus far. &nbsp;The net product is a highly available, elastic, cloud-portable Storm cluster with a single management dashboard. &nbsp; In a future post I&#8217;ll show how we can optimize Storm performance by interfacing it with our in-memory data grid (<span class="caps">XAP</span>). &nbsp;For now, first a brief introduction to Storm, and then a discussion of the recipes. This introduction is not meant be an exhaustive explanation of Storm&#8217;s features (which is found at <a href="http://storm-project.net">http://storm-project.net</a>.</p>
<h3 style="color:blue"><strong>Storm in a Nutshell</strong></h3>
<p>Storm is a real time, open source data streaming framework that functions entirely in memory. &nbsp;It constructs a processing graph that feeds data from an input source through processing nodes. &nbsp;The processing graph is called a &#8220;topology&#8221;. &nbsp;The input data sources are called &#8220;spouts&#8221;, and the processing nodes are called &#8220;bolts&#8221;. &nbsp;The data model consists of tuples. &nbsp;Tuples flow from Spouts to the bolts, which execute user code. Besides simply being locations where data is transformed or accumulated, bolts can also join streams and branch streams. &nbsp;Storm is designed to be run on several machines to provided parallelism. &nbsp;Storm topologies are deployed in a manner somewhat similar to a webapp or a <span class="caps">XAP</span> processing unit; a jar file is presented to a deployer which distributes it around the cluster where it is loaded and executed. &nbsp;A topology runs until it is killed.</p>
<p style="text-align: center"><img height="235" width="333" src="http://blog.gigaspaces.com/wp-content/uploads/image/topology.png" alt=""></p>
<p>Nodes in the diagram do not imply physical or even VM boundaries. &nbsp;Storm&#8217;s execution planning will avoid unnecessary network hops, combining operations in a single node where appropriate.<br />
<h3 style="color:blue"><strong>Data Flow In Storm</strong></h3><br />
<p>Storm processes streams of tuples. &nbsp;A stream is defined to be an unlimited ordered sequence of tuples, and tuples are one dimensional arrays of values. &nbsp;The values themselves can be any java primitive type, and can also extend to arbitrary types with the use of custom serializers.</p><br />
<p><strong>A Super Simple Example Topology</strong></p><br />
<p>To understand Storm, we&#8217;ll start from the simplest possible (meaningful) topology, and grow from there. Using the age old twitter example, imagine a stream of tweets, and a desire to count the number of words each user posts in real time. &nbsp;If you recall from above, topologies begin by reading tuples from a &#8220;spout&#8221;. &nbsp;The simplest kind of spout is an &#8220;unreliable&#8221; spout, so we&#8217;ll consider that here. &nbsp;An &#8220;unreliable&#8221; spout is one that can&#8217;t replay tuples: it is fire and forget. &nbsp;Since we&#8217;re predicting that our storm infrastructure is reliable (and failures rare), and we&#8217;re just counting for statistical reasons, we can tolerate an unreliable spout. &nbsp;So we implement an unreliable spout that can provide tuples to Storm. &nbsp;Our tuple will simply be two strings: { tweeter, tweet }. When our topology is deployed, the framework begins polling the Spout for tuples. &nbsp;Each tuple will be fully processed before the next is read.</p><br />
<p>So now we have tweets streaming in. &nbsp;Storm operates by polling, so when it is ready for a new tuple, it calls our spout and asks for one. &nbsp;If we have no &#8220;bolt&#8221; defined, nothing else happens. &nbsp;Since we wanted to track word count per user, we need a bolt. &nbsp;Our bolt will be fed each tuple by the framework. &nbsp;The bolt will simply contain a data structure (Map) that stores the word count for each user in memory. &nbsp;These counts will be updated as tuples arrive. &nbsp;Then the next tuple is read by the framework and so on.</p><br />
<p style="text-align: center"><img height="128" width="460" src="http://blog.gigaspaces.com/wp-content/uploads/image/wordcountflow.png" alt=""></p><br />
<p>&nbsp;</p><br />
<p><strong>An Improvement : Batching</strong></p><br />
<p>What if I have a longer pipeline of stream processors/bolts? &nbsp;It&#8217;s rather inefficient to read and process only one tuple at a time. &nbsp;To overcome this, Storm supports the concept of &#8220;batch&#8221; spouts. &nbsp;Batch spouts read batches of tuples. &nbsp;The batch fails or succeeds as a group. &nbsp;If the spout can keep up, and failures are rare, the batching strategy will be far more performant than reading one tuple at a time. &nbsp;At the same time, having unreliable spouts, as we did in the first example, becomes more problematic: where dropping an occassional tuple on a failure is tolerable, maybe losing 1000 when a single one fails might not be. &nbsp;Thus the demand for reliable spouts grows. &nbsp;A reliable spout is one that can replay a tuple or batch when a error occurs.</p><br />
<p><strong>Another Improvement : Persistent State</strong></p><br />
Storm stores its operational state in Zookeeper, an in-memory cluster coordination service. This is operational state however, not the state of individual tuple batches, or topology specific state. &nbsp;When we revisit the bolt in the example topology above, it accumulates state in an embedded data structure in memory. &nbsp;Naturally, this is volatile and probably undesirable in the real world. &nbsp;Storm provides a capability for reliably using sources of state that are external to Storm itself. &nbsp;More details on this later. &nbsp;Typically, this is via a data store (NoSQL) or memory (memcached). &nbsp;In this way, state information can be queried by external observers of the stream processing.<br />
<h3 style="color:blue"><span style="color: blue">The Cloudify recipes</span></h3><br />
I&#8217;ve built 3 Cloudify recipes to Cloudify Storm. These recipes don&#8217;t address any services external to Storm itself (e.g. persistence). &nbsp;The services are:<br />
<ul><br />
<li>&nbsp;z<strong>ookeeper </strong>- Storm uses Zookeeper to communicate between the &#8220;Nimbus&#8221;(master) and the &#8217;Supervisors&quot; (workers), as well as to store its current state.</li></p>
</ul>
<ul>
<li><strong>storm-nimbus</strong> &ndash; The topology execution coordinator for the cluster. &nbsp;The Nimbus is a singleton in the cluster (i.e. not elastic). &nbsp;It is stateless however (due to storing state in Zookeeper) and there for can fail and be restarted without consequence even to running jobs.</li>
</ul>
<ul>
<li><strong>storm-supervisor</strong> &ndash; The supervisors actually run the topology code. &nbsp;There can/should be many of these (i.e. elastic). &nbsp;The parallelism attributes of a given topology are specified in the topology itself.</li>
</ul>
<p><strong>Zookeeper : Recipe Details</strong></p>
<p>The source for this recipe can be found at github: <a href="https://github.com/CloudifySource/cloudify-recipes/tree/master/services/zookeeper" onclick="javascript:pageTracker._trackPageview('/outgoing/github.com/CloudifySource/cloudify-recipes/tree/master/services/zookeeper');">https://github.com/CloudifySource/cloudify-recipes/tree/master/services/zookeeper</a>. &nbsp;Zookeeper coodinates activity in the cluster, and provides operational state storage. &nbsp;An interesting note is that due it&#8217;s leader election algorithm, it needs to always have an odd number of instances. &nbsp;So if you want HA, the fewest you can have is 3. &nbsp;The recipe is only functional on *nix (only tested on Linux). &nbsp;It should also be noted that Zookeeper is not elastic by design: there is no way to add nodes at runtime. &nbsp;There are probably 3 interesting things about the Zookeeper recipe that make it standout: the install, templating, and the monitor.</p>
<p><strong>The install<br>
	</strong></p>
<p>The Zookeeper install is interesting because Zookeeper requires, as a prerequisite to starting, a file listing all the other Zookeeper nodes in it. &nbsp;This is interesting, because on a Cloud we have no idea what the hosts/IPs are prior to starting the VM. &nbsp;The key is to wait for all the planned instances to be available by using the service context. &nbsp;The important thing to understand is that the context returns the instances as soon as the VM has started: it doesn&#8217;t mean that the instance has actually been through its &#8220;start&#8221; lifecycle phase. &nbsp;Another little gotcha is that each IP in the Zookeeper host list has to have a number attached, and that number-&gt;IP relationship must be the same on every node. &nbsp;The simple solution was to just sort the list prior to assigning the numbers (1..n).</p>
<p><strong>Templating</strong></p>
<p>This is a handy pattern for creating templates of script and configuration files used in a service. &nbsp;The Zookeeper service has a templates subdirectory that contains various configuration and script files that require modification prior to service startup. &nbsp;They use Groovy templating. &nbsp;The most interesting example is the zoo.cfg file, which contains the list of Zookeeper host IPs mentioned previously:</p>
<p><code>&lt;% hosts.eachWithIndex { host,i -&gt; %&gt;server.${i+1}=${host}:2222:2223
&lt;% } %&gt; </code><br />
<p>If you&#8217;re familiar with <span class="caps">JSP</span> syntax (or <span class="caps">ASP</span> for that matter), the above will look familiar. &nbsp;Text inside &lt;% %&gt; pairs is interpreted as groovy code, and text inside <code>${} </code>is treated as groovy vars. &nbsp;Inside the recipe itself, the value of the variable &#8220;host&#8221; is provided and the template evaluated like so:</p><br />
<script src="http://gist.github.com/5112172.js"></script><link rel="stylesheet" media="screen" href="https://gist.github.com/assets/embed-0af287a4b5c981db301049e56f06e5d3.css"><div class="gist" id="gist5112172"><br />
      <div class="gist-file"><br />
        <div class="gist-data gist-syntax"></p>
<div class="file-data">
<table cellspacing="0" cellpadding="0" class="lines highlight">
      <tbody><tr><br />
        <td class="line-numbers"><br />
          <span rel="file-templating1-L1" id="file-templating1-L1" class="line-number">1</span><br />
          <span rel="file-templating1-L2" id="file-templating1-L2" class="line-number">2</span><br />
          <span rel="file-templating1-L3" id="file-templating1-L3" class="line-number">3</span><br />
          <span rel="file-templating1-L4" id="file-templating1-L4" class="line-number">4</span>        </td>
<td class="line-data">
<pre class="line-pre"><div id="file-templating1-LC1" class="line">def binding=[<a href="ips">hosts</a>,&#8220;clientPort&#8221;:&#8220;${config.clientPort}&#8221;]</div><div id="file-templating1-LC2" class="line">def zoo = new File(&#8216;templates/zoo.cfg&#8217;)</div><div id="file-templating1-LC3" class="line">engine = new SimpleTemplateEngine()</div><div id="file-templating1-LC4" class="line">template = engine.createTemplate(zoo).make(binding)</div></pre>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="gist-meta">
<a style="float:right" href="https://gist.github.com/dfilppi/5112172/raw/9a9fe8783d508d6fd3729eafee9527c906524948/templating1">view raw</a>
<a style="float:right; margin-right:10px; color:#666;" href="https://gist.github.com/dfilppi/5112172#file-templating1">templating1</a>
<a href="https://gist.github.com/dfilppi/5112172">This Gist</a> brought to you by <a href="http://github.com">GitHub</a>.
</div>
</div>
</div>
<p>The &#8220;clientPort&#8221; binding is ignored by the template, but that is irrelevant. &nbsp;The output of this template is a config file with a properly formatted list of IPs, something like:</p>
<p><code>server.1=10.10.10.10</code></p>
<p><code>server.2=10.10.10.11</code></p>
<p><code>server.3 .....</code></p>
<p><strong>The Monitor</strong></p>
<p>The monitor is simple, but a nice example about how Cloudify monitoring should be thought of as simply returning a map of key/value pairs, and not in terms of <span class="caps">JMX</span> or any particular technology. &nbsp;This simplicity is a great strength. &nbsp;It turns out that Zookeeper will reveal it&#8217;s runtime status by opening a socket and writing a string to it.</p>
<p>The output on the socket has interesting info about messaging traffic. &nbsp;The string that Zookeeper responds to is &#8220;stat&#8221;, and the monitor is a simple bash script:</p>
<script src="http://gist.github.com/5112305.js"></script><link rel="stylesheet" media="screen" href="https://gist.github.com/assets/embed-0af287a4b5c981db301049e56f06e5d3.css"><div class="gist" id="gist5112305"><br />
      <div class="gist-file"><br />
        <div class="gist-data gist-syntax"><br />
<br />
<br />
<br />
  <div class="file-data"><br />
    <table cellspacing="0" cellpadding="0" class="lines highlight"><br />
      <tbody><tr><br />
        <td class="line-numbers"><br />
          <span rel="file-gistfile1-sh-L1" id="file-gistfile1-sh-L1" class="line-number">1</span>        </td>
<td class="line-data">
<pre class="line-pre"><div id="file-gistfile1-sh-LC1" class="line"><span class="nb">echo </span>stat |nc 127.0.0.1 <span class="nv">$<span class="caps">PORT</span></span> |awk -F : <span class="s1">&#8216;{gsub(/ */,&quot;&quot;);if ($1 == &#8220;Received&#8221; || $1 == &#8220;Sent&#8221; || $1 == &#8220;Outstanding&#8221;) print $2}&#8217;</span></div></pre>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="gist-meta">
<a style="float:right" href="https://gist.github.com/dfilppi/5112305/raw/83f8e59876b8adab429a2901586386febdc2034b/gistfile1.sh">view raw</a>
<a style="float:right; margin-right:10px; color:#666;" href="https://gist.github.com/dfilppi/5112305#file-gistfile1-sh">gistfile1.sh</a>
<a href="https://gist.github.com/dfilppi/5112305">This Gist</a> brought to you by <a href="http://github.com">GitHub</a>.
</div>
</div>
</div>
<p>Basically, &#8220;stat&#8221; is echo&#8217;d to the Zookeeper port on the service instance. &nbsp;The resulting response string is fed to awk, where it is filtered. &nbsp;The resulting list of three numbers is returned to the recipe and a map is created from it:</p>
<script src="http://gist.github.com/5112362.js"></script><link rel="stylesheet" media="screen" href="https://gist.github.com/assets/embed-0af287a4b5c981db301049e56f06e5d3.css"><div class="gist" id="gist5112362"><br />
      <div class="gist-file"><br />
        <div class="gist-data gist-syntax"><br />
<br />
<br />
<br />
  <div class="file-data"><br />
    <table cellspacing="0" cellpadding="0" class="lines highlight"><br />
      <tbody><tr><br />
        <td class="line-numbers"><br />
          <span rel="file-nimbus-monitor-L1" id="file-nimbus-monitor-L1" class="line-number">1</span><br />
          <span rel="file-nimbus-monitor-L2" id="file-nimbus-monitor-L2" class="line-number">2</span><br />
          <span rel="file-nimbus-monitor-L3" id="file-nimbus-monitor-L3" class="line-number">3</span><br />
          <span rel="file-nimbus-monitor-L4" id="file-nimbus-monitor-L4" class="line-number">4</span><br />
          <span rel="file-nimbus-monitor-L5" id="file-nimbus-monitor-L5" class="line-number">5</span><br />
          <span rel="file-nimbus-monitor-L6" id="file-nimbus-monitor-L6" class="line-number">6</span><br />
          <span rel="file-nimbus-monitor-L7" id="file-nimbus-monitor-L7" class="line-number">7</span><br />
          <span rel="file-nimbus-monitor-L8" id="file-nimbus-monitor-L8" class="line-number">8</span>        </td>
<td class="line-data">
<pre class="line-pre"><div id="file-nimbus-monitor-LC1" class="line">def metrics=[]</div><div id="file-nimbus-monitor-LC2" class="line">&nbsp;</div><div id="file-nimbus-monitor-LC3" class="line">def process=&#8220;${context.serviceDirectory}/stat.sh ${clientPort}&#8221;.execute()</div><div id="file-nimbus-monitor-LC4" class="line">process.in.eachLine{line-&gt; </div><div id="file-nimbus-monitor-LC5" class="line">  metrics.add line</div><div id="file-nimbus-monitor-LC6" class="line">}</div><div id="file-nimbus-monitor-LC7" class="line">&nbsp;</div><div id="file-nimbus-monitor-LC8" class="line">[ <a href="metrics[0">Packets Received</a>],<a href="metrics[1">Packets Sent</a>],<a href="metrics[2">Outstanding Requests</a>]]</div></pre>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="gist-meta">
<a style="float:right" href="https://gist.github.com/dfilppi/5112362/raw/a4470f5ab0f0d9a1fe8c90a7b81fef02049b2acb/nimbus-monitor">view raw</a>
<a style="float:right; margin-right:10px; color:#666;" href="https://gist.github.com/dfilppi/5112362#file-nimbus-monitor">nimbus-monitor</a>
<a href="https://gist.github.com/dfilppi/5112362">This Gist</a> brought to you by <a href="http://github.com">GitHub</a>.
</div>
</div>
</div>
<p><strong>Storm Nimbus &ndash; Recipe Details</strong></p>
<p><span style="font-size: 12px">The source for this recipe can be found at github:&nbsp;<a href="https://github.com/CloudifySource/cloudify-recipes/tree/master/services/storm/storm-nimbus" onclick="javascript:pageTracker._trackPageview('/outgoing/github.com/CloudifySource/cloudify-recipes/tree/master/services/storm/storm-nimbus');">https://github.com/CloudifySource/cloudify-recipes/tree/master/services/storm/storm-nimbus</a>.&nbsp;</span>The Storm Nimbus is basically a superset of the Storm Supervisor recipe, so I&#8217;ll just go over a few interesting details of storm-nimbus.</p>
<p><strong>The Install</strong></p>
<p>Like the Zookeeper recipe above, the storm-nimbus uses Groovy templating to modify a configuration file supplied in the &#8220;templates&#8221; directory. &nbsp;At the beginning of the install, storm-nimbus (which depends on Zookeeper running) gets the Zookeeper services instances from the service context. &nbsp;This list is iterated over in the storm.yaml config file:</p>
<script src="http://gist.github.com/5112418.js"></script><link rel="stylesheet" media="screen" href="https://gist.github.com/assets/embed-0af287a4b5c981db301049e56f06e5d3.css"><div class="gist" id="gist5112418"><br />
      <div class="gist-file"><br />
        <div class="gist-data gist-syntax"><br />
<br />
<br />
<br />
  <div class="file-data"><br />
    <table cellspacing="0" cellpadding="0" class="lines highlight"><br />
      <tbody><tr><br />
        <td class="line-numbers"><br />
          <span rel="file-templating-example-L1" id="file-templating-example-L1" class="line-number">1</span><br />
          <span rel="file-templating-example-L2" id="file-templating-example-L2" class="line-number">2</span><br />
          <span rel="file-templating-example-L3" id="file-templating-example-L3" class="line-number">3</span><br />
          <span rel="file-templating-example-L4" id="file-templating-example-L4" class="line-number">4</span><br />
          <span rel="file-templating-example-L5" id="file-templating-example-L5" class="line-number">5</span>        </td>
<td class="line-data">
<pre class="line-pre"><div id="file-templating-example-LC1" class="line">storm.zookeeper.servers:</div><div id="file-templating-example-LC2" class="line">&nbsp;</div><div id="file-templating-example-LC3" class="line">&lt;% zooks.each { zook -&gt;</div><div id="file-templating-example-LC4" class="line">  println &quot;  &#8211;  \&#8220;${zook.hostAddress}\&#8221;&quot;</div><div id="file-templating-example-LC5" class="line">} %&gt;</div></pre>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="gist-meta">
<a style="float:right" href="https://gist.github.com/dfilppi/5112418/raw/de4adc508166eac98f8f66b0be503e00ea4fef22/templating+example">view raw</a>
<a style="float:right; margin-right:10px; color:#666;" href="https://gist.github.com/dfilppi/5112418#file-templating-example">templating example</a>
<a href="https://gist.github.com/dfilppi/5112418">This Gist</a> brought to you by <a href="http://github.com">GitHub</a>.
</div>
</div>
</div>
<p>But the biggest thing going on in the install is an actual build of a native library. Storm depends on the zeromq library for network communication, but it is a native library that requires a build. &nbsp;Both the storm-nimbus and storm-supervisor recipes perform this build. &nbsp;This was intended on a catch all approach for making a generic demo, <span class="caps">NOT</span> as a recommended approach. &nbsp;It slows down install greatly. &nbsp;In the &#8220;real&#8221; world, please have pre-built binaries in a blog store and download them.</p>
<p>In any case, this build task causes the recipe to only run on Linux distros that support &#8220;yum&#8221;, which is used to pull down various dependencies such as python, gcc, make, etc.. &nbsp;It also pulls from github and builds jzmq. &nbsp;If you&#8217;re interested, check out the &#8220;initnode.sh&#8221; script in the recipe.</p>
<p><strong>Monitoring</strong></p>
<p><span style="font-size: 12px">To monitor the Nimbus, I wrote a java <a href="https://github.com/Gigaspaces/storm-integration/tree/master/cloudify/plugins/nimbus-thrift-plugin" onclick="javascript:pageTracker._trackPageview('/outgoing/github.com/Gigaspaces/storm-integration/tree/master/cloudify/plugins/nimbus-thrift-plugin');">plugin</a> for Cloudify.&nbsp; Why not&nbsp;</span><span style="font-size: 12px">Groovy? &nbsp;Personally, beyond a certain threshold of complexity, I find java development&nbsp;</span><span style="font-size: 12px">environments (i.e. Eclipse) to be more productive. &nbsp;Having said that, porting it to&nbsp;</span><span style="font-size: 12px">Groovy would clean things up greatly. &nbsp;As it is, the recipe requires several jar files&nbsp;</span><span style="font-size: 12px">in the usmlib directory to support it (thift, etc&#8230;). &nbsp; The plugin itself is&nbsp;</span><span style="font-size: 12px">unremarkable: it simply calls the Thrift interface and get the Nimbus configuration&nbsp;</span><span style="font-size: 12px">and extracts some key metrics. &nbsp;It is hard coded, and obviously should be configurable&nbsp;</span><span style="font-size: 12px">to select metrics of interest.</span></p>
<p><strong><span style="font-size: 12px">Custom Commands</span></strong></p>
<p><span style="font-size: 12px">There a few custom commands that can&#8217;t be explained until the <span class="caps">XAP</span> integration is </span><span style="font-size: 12px">discussed in future posts. &nbsp;These commands deal with running and kill topologies, and are tailored to the <span class="caps">XAP</span> integration. &nbsp;Generic topology management commands could be adapted from them however.</span></p>
<h3 style="color:blue"><span style="font-size: 12px">Conclusion</span></h3>
<p><span style="font-size: 12px">These recipes have been tested on EC2 and <span class="caps">HPCS</span>/Openstack. &nbsp;There is an application recipe under app/storm in the cloudify-recipes repo. &nbsp;When you run it, give a healthy timeout, since the install runs yum fetches and builds for the native libs. In my next post, I&#8217;ll discuss the rationale for combining GigaSpaces <span class="caps">XAP</span> with Storm,&nbsp;</span><span style="font-size: 12px">and share the implementation of components to support it.</span></p>
<p></div><!--end entry--></p>
<p></p>
<p></p>
<p></p>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'cloudifysource'; // required: replace example with your forum shortname
    var disqus_identifier = '/2013/03/07/gigaspaces_and_storm_part_1_storm_clouds.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

					
					
					</div>			
				</div>	
				
				<!-- Blog Left side coll -->
				<div class="span3">
					<aside class="right-sidebar">
						<!--Event groups-->



<div class="leftContentBox blogLeft-topTitle">
	<h3>Recent Posts</h3>
</div>


<div class="leftContentBox blogLeftBox"> 
   
	<a href="/2013/11/01/cloud_devops_orchestration.html">Cloud DevOps Orchestration 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">November  1, 2013</span>  
	<br/><br/>
  
	<a href="/2013/11/01/cloud_devops_orchestration.html">Cloud_devops_orchestration 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">November  1, 2013</span>  
	<br/><br/>
  
	<a href="/2013/10/30/the_breakup_why_openstack_needs_a_native_alternative_to_cloudfoundry_and_openshift.html">The Breakup - Why OpenStack Needs a Native Alternative to CloudFoundry and Openshift 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">October 30, 2013</span>  
	<br/><br/>
		
</div>

               <!--start -->
                 <div class="leftContentBox blogLeft-topTitle blog-left-title2 tumblr">
                        <h3>CloudifySource on Tumblr</h3>
                 </div>   
                <div class="leftContentBox tumblrFeed">                     
                
                </div>
<!--end-->


<div class="leftContentBox blogLeft-topTitle">
	<h3>Archived Posts</h3>
</div>

 <ul class="blog-archive-list">
 
 
	
	
	
	
	
	

	
<li><a href="/2013/11">November 2013</a> <span class="blue">(2)</span></li>

	

	
		
			
<li><a href="/2013/10">October 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/10">October 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/09">September 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/09">September 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/08">August 2013</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/08">August 2013</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/07">July 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/07">July 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/06">June 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/06">June 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/05">May 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/05">May 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/04">April 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/04">April 2013</a> <span class="blue">(6)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/03">March 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/03">March 2013</a> <span class="blue">(8)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/02">February 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/02">February 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/01">January 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2013/01">January 2013</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		

<li><a href="/2012/12">December 2012</a> <span class="blue">(6)</span></li>

		
	

	
	
	
	
	
	

	

	
		

<li><a href="/2012/12">December 2012</a> <span class="blue">(6)</span></li>

		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/11">November 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/11">November 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/10">October 2012</a> <span class="blue">(10)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/10">October 2012</a> <span class="blue">(10)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/09">September 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/09">September 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/08">August 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/08">August 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/07">July 2012</a> <span class="blue">(10)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/06">June 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/06">June 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/05">May 2012</a> <span class="blue">(10)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/05">May 2012</a> <span class="blue">(10)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/03">March 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/03">March 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/02">February 2012</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/01">January 2012</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		

<li><a href="/2011/11">November 2011</a> <span class="blue">(1)</span></li>

		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2011/10">October 2011</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2011/09">September 2011</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	

	





 
 </ul>
					</aside>
				</div>
			</div>	
	</div>	
	</section>	
	<div class="clear"></div>
	<!--Start Footer -->
		<footer>
	<div class="container">
		<div class="row">
			<div class="span3">
				<div class="widget">
					<h5 class="widgetheading">Browse pages</h5>
					<ul class="link-list">
						<li><a href="about.html">About Us</a></li>
						<li><a href="goPro.html">Enterprise Cloudify</a></li>
						<li><a href="cloudifyrecipecatalog.html">Cloudify Test Drive</a></li>
						<li><a href="how.html">How it Works</a></li>
						<li><a href="#">Get in touch with us</a></li>
					</ul>
				</div>
			</div>
			<div class="span3">
				<div class="widget">
					<h5 class="widgetheading">Important stuff</h5>
					<ul class="link-list">
						<li><a href="#">Press & Coverage</a></li>
						<li><a href="http://www.cloudifysource.org/terms_of_use">Terms of Use</a></li>
						<li><a href="http://www.cloudifysource.org/privacy_policy">Privacy policy</a></li>
						<li><a href="#">Github Repo</a></li>
						<li><a href="https://cloudifysource.zendesk.com/home" target="_blank">Support forums</a></li>
					</ul>
				</div>
			</div>
			<div class="span3">
				<!--<div class="widget">
					<h5 class="widgetheading">Flickr photostream</h5>
					<div class="flickr_badge">
						<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?count=8&amp;display=random&amp;size=s&amp;layout=x&amp;source=user&amp;user=34178660@N03"></script>
					</div>
					<div class="clear">
					</div>
				</div>-->
			</div>
			<div class="span3">
				<div class="widget">
					<h5 class="widgetheading">Get in touch with us</h5>
					<strong>Where to get support</strong><br>
					 	<p>
						<i class="icon-comments-alt"></i><a href="https://cloudifysource.zendesk.com/home" target="_blank"> Support forums</a><br>
						<i class="icon-envelope-alt"></i> info@cloudifysource.org<br>
						<i class="fa fa-stack-overflow"></i><a href="http://stackoverflow.com/questions/tagged/cloudify"target="_blank"> Stack Overflow</a><br>
						<i class="icon-user"></i><a href="https://cloudifysource.zendesk.com/login?return_to=https%3A//cloudifysource.zendesk.com/home" target="_blank">Login</a> / <a href="https://cloudifysource.zendesk.com/registration" target="_blank">Register</a>

					</p>
				</div>
			</div>
		</div>
	</div>
	<div id="sub-footer">
		<div class="container">
			<div class="row">
				<div class="span6">
					<div class="copyright">
						<p>
							<span>&copy; Flattern 2013 All right reserved. Designed by</span><a href="http://iweb-studio.com" target="_blank">iweb-studio</a>
						</p>
					</div>
				</div>
				<div class="span6">
					<ul class="social-network">
						<li><a href="https://www.facebook.com/GigaSpaces?sk=app_201742856511228" data-placement="bottom" title="Facebook"><i class="icon-facebook icon-square"></i></a></li>
						<li><a href="https://twitter.com/intent/follow?screen_name=cloudifysource" data-placement="bottom" title="Twitter"><i class="icon-twitter icon-square"></i></a></li>
						<li><a href="http://www.tumblr.com/follow/cloudifysource" data-placement="bottom" title="Tumblr"><i class="fa-tumblr icon-square"></i></a></li>
						<li><a href="http://www.youtube.com/cloudifysource" data-placement="bottom" title="YouTube"><i class="fa-youtube icon-square"></i></a></li>						
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div class="clear"></div>
	</footer>




			
	</div>
</body>
</html>
